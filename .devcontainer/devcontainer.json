{
  "name": "PlatformIO",
  "build": {
    "dockerfile": "Dockerfile",
    // Append -bullseye or -buster to pin to an OS version.
    // Use -bullseye variants on local on arm64/Apple Silicon.
    "args": {
      "VARIANT": "python:slim-bullseye",
      "PIO_VERSION": "6.1.18"
    }
  },
  // Configure tool-specific properties.
  "customizations": {
    // Configure properties specific to VS Code.
    "vscode": {
      // Set *default* container specific settings.json values on container create.
      "settings": {
        // Use fixed port for pio home
        "platformio-ide.pioHomeServerHttpPort": 8008,
        "platformio-ide.disablePIOHomeStartup": true
      },
      // Add the IDs of extensions you want installed when the container is created.
      "extensions": [
        "ms-vscode.cpptools",
        "pioarduino.pioarduino-ide"
      ]
    }
  },

  // Use 'forwardPorts' to make a list of ports inside the container available locally.
  "forwardPorts": [
    // PIO Home is blank if its port isn't exposed from within the container.
    8008
  ],
  // Use 'postCreateCommand' to run commands after the container is created.

  // Comment out this line to run as root instead.
  "remoteUser": "vscode",
  "runArgs": [
    // Privilegierter Modus für vollen Hardware-Zugriff
    "--privileged",
    // Spezifisch für USB-Serial-Konverter (FTDI, CH340, CP210x)
    "--device-cgroup-rule=c 188:* rmw",
    // Für Arduino-kompatible Boards mit ACM
    "--device-cgroup-rule=c 166:* rmw"
  ],
  "mounts": [
    // Mount the host's device to this container's.
    "source=/dev,target=/dev,type=bind,consistency=consistent"
  ],
  "postCreateCommand": "mkdir -p $HOME/Documents/PlatformIO && ln -s $(pwd) $HOME/Documents/PlatformIO/Projects",
  "postAttachCommand": "sudo curl -o /etc/udev/rules.d/99-platformio-udev.rules https://raw.githubusercontent.com/platformio/platformio-core/develop/platformio/assets/system/99-platformio-udev.rules || true && sudo usermod -a -G dialout,plugdev vscode"
}
